<div class="title-container mt-4">
  <i class="fa-solid fa-desktop"></i>
  <h1 class="text-center title-shadow">REGISTER PRODUCT</h1>
</div>
<div class="line mb-4"></div>

<%= simple_form_for @product, html: { multipart: true, class: "product-form" } do |form| %>
  <%= form.error_notification %> <%# Mostrar erros de validação %>

  <div class="product-form-container">
    <%# --- COLUNA DA ESQUERDA --- %>
    <div class="form-column">
      <%= form.input :name, label: "Product Name:" %>
      <%= form.input :model, label: "Model:" %>
      <%= form.input :manufacturer, label: "Manufacturer:" %>
      <%= form.input :category, collection: Product::CATEGORIES, label: "Category:", prompt: "Select a category" %>
    </div>

    <%# --- COLUNA DA DIREITA --- %>
    <div class="form-column">
      <%= form.input :price, label: "Price:" %>
      <%= form.input :overview, label: "Overview:", as: :text, input_html: { rows: 6 } %>

      <%# --- SEÇÃO DE IMAGENS (COM PREVIEW) --- %>
      <div class="form-group mb-4" data-controller="image-preview">
        <label class="form-label mb-2">Product Images: *</label>

        <%# Galeria de imagens JÁ SALVAS (Vinda do Banco) %>
        <% if @product.photos.attached? %>
          <div class="edit-gallery mb-2">
            <% @product.photos.each do |photo| %>
              <div class="gallery-item" id="<%= dom_id(photo) %>">
                <%= cl_image_tag photo.key, crop: :fill, width: 100, height: 100 %>
                <%= link_to delete_photo_product_path(@product, photo_id: photo.id),
                            data: { turbo_method: :delete, turbo_confirm: "Delete this image?" },
                            class: "btn-delete-photo" do %>
                  <i class="fa-solid fa-times"></i>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>

        <%# Área de PREVIEW (Para novas imagens selecionadas) %>
        <div class="edit-gallery" data-image-preview-target="previewContainer"></div>

        <%# Botão de Upload %>
        <div class="custom-file-upload">
          <%= form.input_field :photos,
                               as: :file,
                               multiple: true,
                               accept: 'image/*',
                               id: "product_photos_input",
                               data: {
                                 image_preview_target: "input",
                                 action: "change->image-preview#addFiles"
                               } %>

          <label for="product_photos_input" class="btn-upload">
            <i class="fa-solid fa-cloud-arrow-up"></i>
            <span>
              <%= @product.persisted? && @product.photos.attached? ? "Add More Images" : "Choose Images" %>
            </span>
          </label>
        </div>

        <% if @product.errors[:photos].any? %>
          <div class="text-danger small mt-2">
            <%= @product.errors[:photos].join(", ") %>
          </div>
        <% end %>
      </div>

      <div class="form-footer text-center">
        <%= form.submit "Submit", class: "btn btn-submit" %>
      </div>
    </div>
  </div>
<% end %>
