<div class="checkout-page">
  <div class="title-container mt-4">
    <h1 class="text-center title-shadow">CHECKOUT</h1>
  </div>
  <div class="line mb-4"></div>

  <div class="row" data-controller="checkout">

    <%# Coluna da Esquerda (Formulário) %>
    <div class="col-md-6 pe-5">
      <%= simple_form_for @order, url: orders_path, method: :post, html: { class: 'form-checkout' } do |f| %>

        <h3>DELIVERY</h3>
        <div class="form-group">
          <%= f.input :planet, label: "Planet", input_html: { class: "form-control custom-input", required: true } %>
        </div>
        <div class="form-group">
          <%= f.input :address, label: "Address", input_html: { class: "form-control custom-input", required: true } %>
        </div>

        <h3>SHIPPING METHOD</h3>
        <div class="form-check">
          <%= f.radio_button :shipping_method, "Shooting Star Deliveries", id: "shipping_standard", checked: true, class: "form-check-input", data: { action: "checkout#updateShipping" } %>
          <%= f.label :shipping_method, "Shooting Star Deliveries - 5 to 10 Days", for: "shipping_standard", class: "form-check-label" %>
        </div>
        <div class="form-check">
          <%= f.radio_button :shipping_method, "Meteor Post Express", id: "shipping_express", class: "form-check-input", data: { action: "checkout#updateShipping" } %>
          <%= f.label :shipping_method, "Meteor Post Express - Scheduled Delivery", for: "shipping_express", class: "form-check-label" %>
        </div>

        <h3>PAYMENT</h3>
        <p>This is the address for your ₿ deposit. You can scan the QR CODE for quick sending.</p>
        <div class="input-group mb-3">
          <input type="text" readonly class="form-control custom-input" value="hY7jU45GbbNgdI890HkkLhelL90">
          <button class="btn btn-light copy-btn" type="button">Copy</button>
        </div>
        <div class="qr-code">
          <%# (Para adicionar um QR code aqui no futuro, se for o caso) %>
        </div>

        <%= f.button :submit, "Confirm Order",
            class: "btn btn-primary btn-block mt-4",
            disabled: @cart_products.empty? %>

        <% if @cart_products.empty? %>
          <p class="text-danger small mt-2 text-center">
            Your cart is empty. Add products to continue.
          </p>
        <% end %>
      <% end %>
    </div>

    <%# Coluna da Direita (Resumo do Pedido) %>
    <div class="col-md-6 ps-5">
      <div class="order-summary">
        <h3>YOUR CART</h3>
        <% if @cart_products.any? %>
          <ul class="list-group" data-checkout-target="cart">
            <% @cart_products.each do |product| %>
              <li id="product_<%= product.id %>" data-price="<%= product.price %>" class="list-group-item d-flex justify-content-between align-items-center">
                <span><%= product.name %> - <%= number_to_currency(product.price, unit: "₿ ") %></span>
                <%= button_to "Remove", remove_from_cart_orders_path(product_id: product.id),
                            method: :delete,
                            class: "btn btn-sm btn-danger" %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p>Your cart is empty. <a href="<%= products_path %>">Continue shopping</a>.</p>
        <% end %>

        <h3 class="mt-4">SUMMARY</h3>

        <%# 1. Usando o helper para formatar o subtotal inicial %>
        <p>
          Subtotal:
          <span data-checkout-target="subtotal" data-value="<%= @subtotal %>">
            <%= number_to_currency(@subtotal, unit: "₿ ") %>
          </span>
        </p>
        <%# 2. Usamos o helper para formatar o frete inicial %>
        <p>
          Shipping:
          <span data-checkout-target="shipping">
            <%= number_to_currency(10000.0, unit: "₿ ") %>
          </span>
        </p>
        <%# 3. Usando o helper para formatar o total inicial %>
        <p>
         Total:
         <span data-checkout-target="total" class="text-neon">
           <%= number_to_currency(@subtotal + 10000.0, unit: "₿ ") %>
         </span>
        </p>
      </div>
    </div>

  </div>
</div>
